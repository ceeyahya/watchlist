import axios from 'axios';
import type { NextPage } from 'next';
import Head from 'next/head';
import {
	BarChart,
	Bar,
	XAxis,
	YAxis,
	CartesianGrid,
	Tooltip,
	Legend,
	ResponsiveContainer,
	ReferenceLine,
} from 'recharts';

const data = [
	{
		name: 'Page A',
		uv: 4000,
		pv: 2400,
		amt: 2400,
	},
	{
		name: 'Page B',
		uv: 3000,
		pv: 1398,
		amt: 2210,
	},
	{
		name: 'Page C',
		uv: 2000,
		pv: 9800,
		amt: 2290,
	},
	{
		name: 'Page D',
		uv: 2780,
		pv: 3908,
		amt: 2000,
	},
	{
		name: 'Page E',
		uv: 1890,
		pv: 4800,
		amt: 2181,
	},
	{
		name: 'Page F',
		uv: 2390,
		pv: 3800,
		amt: 2500,
	},
	{
		name: 'Page G',
		uv: 3490,
		pv: 4300,
		amt: 2100,
	},
];

const Home: NextPage<{
	statistics: {
		movies: number;
		directors: number;
		countries: number;
		mpc: Array<{ nationality: string; count: number }>;
	};
}> = ({ statistics }) => {
	const highestMovieNumber = Math.max(
		...statistics.mpc.map((data) => data.count)
	);
	return (
		<div>
			<Head>
				<title>Watchlist</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<main className=''>
				<h1 className='text-2xl font-bold'>Statistics</h1>
				<dl className='mt-5 grid grid-cols-1 gap-4 sm:grid-cols-3'>
					<div className='px-4 py-5 bg-white shadow-md shadow-gray-200 border border-gray-100 rounded-md overflow-hidden sm:p-6'>
						<dt className='text-sm font-medium text-gray-500 truncate'>
							Movies
						</dt>
						<dd className='mt-1 text-3xl tracking-tight font-semibold text-gray-900'>
							{statistics.movies}
						</dd>
					</div>

					<div className='px-4 py-5 bg-white shadow-md shadow-gray-200 border border-gray-100 rounded-md overflow-hidden sm:p-6'>
						<dt className='text-sm font-medium text-gray-500 truncate'>
							Directors
						</dt>
						<dd className='mt-1 text-3xl tracking-tight font-semibold text-gray-900'>
							{statistics.directors}
						</dd>
					</div>

					<div className='px-4 py-5 bg-white shadow-md shadow-gray-200 border border-gray-100 rounded-md overflow-hidden sm:p-6'>
						<dt className='text-sm font-medium text-gray-500 truncate'>
							Countries
						</dt>
						<dd className='mt-1 text-3xl tracking-tight font-semibold text-gray-900'>
							{statistics.countries}
						</dd>
					</div>
				</dl>
			</main>
			<div className='py-8'>
				<ResponsiveContainer width='50%' height={500}>
					<BarChart
						data={statistics.mpc}
						margin={{ top: 5, right: 20, left: 20, bottom: 80 }}>
						<CartesianGrid strokeDasharray='3 3' />
						<XAxis
							dataKey='nationality'
							interval={0}
							fontSize={10}
							angle={-90}
							dy={50}
							dx={-5}
						/>
						<YAxis />
						<Tooltip />
						<ReferenceLine
							y={highestMovieNumber}
							label={{
								value: `Highest Number of Movies per Country: ${highestMovieNumber}`,
								position: 'top',
								fontSize: 12,
								fontWeight: 'bold',
							}}
							stroke='red'
							strokeDasharray='3 3'
						/>
						<Bar dataKey='count' fill='#4f46e5' />
					</BarChart>
				</ResponsiveContainer>
			</div>
		</div>
	);
};

export async function getServerSideProps() {
	const response = await axios.get('http://127.0.0.1:8080/statistics');

	return {
		props: {
			statistics: response.data,
		},
	};
}

export default Home;
